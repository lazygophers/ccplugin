# 部署指南

## 一、安装方式

### 1.1 从市场安装

```
/plugin install memory
```

### 1.2 从本地安装

```
/plugin install /path/to/memory
```

---

## 二、配置文件

### 2.1 插件配置

位置：`{plugin_root}/config.json`

```json
{
    "auto_save": true,
    "auto_save_threshold": 5,
    "archive_after_days": 30,
    "max_memories": 10000,
    "backup_on_exit": true
}
```

### 2.2 配置项说明

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| auto_save | boolean | true | 是否自动保存 |
| auto_save_threshold | integer | 5 | 自动保存阈值 |
| archive_after_days | integer | 30 | 归档天数 |
| max_memories | integer | 10000 | 最大记忆数 |
| backup_on_exit | boolean | true | 退出时备份 |

---

## 三、依赖安装

### 3.1 Python 依赖

```
pip install -r mcp/requirements.txt
```

**依赖列表**：
- fastmcp >= 0.1.0
- python-dotenv >= 1.0.0

### 3.2 系统依赖

- Python >= 3.8
- SQLite >= 3.35.0
- jq（用于 Hook 脚本）

---

## 四、初始化

### 4.1 数据库初始化

首次使用时自动创建数据库：

```
/memory init
```

或手动初始化：

```
sqlite3 db/memory.db < db/schema.sql
```

### 4.2 创建初始记忆

```
/memory create project:// "项目根目录"
/memory create workflow:// "工作流记忆"
/memory create user:// "用户偏好"
```

---

## 五、升级

### 5.1 检查更新

```
/plugin update memory
```

### 5.2 数据迁移

升级后自动运行迁移脚本，或手动运行：

```
/memory migrate
```

---

## 六、卸载

### 6.1 卸载插件

```
/plugin uninstall memory
```

### 6.2 数据保留

卸载前可选择：
- 导出数据：`/memory export backup.json`
- 保留数据库：数据库文件保留在项目目录
- 完全删除：手动删除 `.claude/memory.db`

---

## 七、故障排除

### 7.1 常见问题

| 问题 | 解决方案 |
|------|----------|
| 插件无法加载 | 检查 plugin.json 格式 |
| 数据库锁定 | 关闭其他连接，重启 Claude Code |
| Hook 不触发 | 检查 hooks.json 配置 |
| 记忆无法保存 | 检查磁盘空间和权限 |

### 7.2 调试模式

启用调试模式查看详细日志：

```
claude --debug
```

### 7.3 日志位置

- 插件日志：`{plugin_root}/logs/memory.log`
- Claude Code 日志：`~/.claude/logs/`
