# Semantic - ä»£ç è¯­ä¹‰æœç´¢æ’ä»¶ï¼ˆæ··åˆæ¶æ„ç‰ˆï¼‰

åŸºäºå‘é‡åµŒå…¥çš„æ™ºèƒ½ä»£ç æœç´¢æ’ä»¶ï¼Œæ”¯æŒå¤šç¼–ç¨‹è¯­è¨€ã€å¤šæ¨¡å‹ã€GPU åŠ é€Ÿã€å¤šå¼•æ“èåˆã€**è¯­è¨€ç‰¹å®šä¼˜åŒ–**ã€‚

## ç‰¹æ€§

- ğŸ” **è¯­ä¹‰æœç´¢** - ä½¿ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢ä»£ç 
- ğŸš€ **æ··åˆå¼•æ“** - FastEmbed + CodeModel + Symbol ä¸‰å±‚èåˆ
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ** - æ”¯æŒ 17+ ç¼–ç¨‹è¯­è¨€
- ğŸ¯ **è¯­è¨€ç‰¹å®šä¼˜åŒ–** - é’ˆå¯¹ä¸åŒè¯­è¨€çš„è§£æç­–ç•¥ã€åˆ†å—å¤§å°ã€æ¨¡å‹æ¨è
- ğŸ¤– **å¤šæ¨¡å‹æ”¯æŒ** - BGEã€Jinaã€GTEã€CodeT5 ç­‰æœ€æ–°åµŒå…¥æ¨¡å‹
- âš¡ **GPU åŠ é€Ÿ** - æ”¯æŒ CUDA åŠ é€Ÿ
- ğŸ—„ï¸ **LanceDB å­˜å‚¨** - è½»é‡çº§å‘é‡æ•°æ®åº“
- ğŸ“Š **å¢é‡ç´¢å¼•** - æ”¯æŒå¢é‡æ›´æ–°ç´¢å¼•
- ğŸ¯ **è½»é‡å¿«é€Ÿ** - ä½¿ç”¨ FastEmbedï¼Œæ— éœ€ PyTorchï¼ˆé»˜è®¤ï¼‰

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
cd plugins/semantic

# é»˜è®¤å®‰è£…ï¼ˆFastEmbedï¼‰
uv sync

# å®Œæ•´å®‰è£…ï¼ˆåŒ…å«ä»£ç æ¨¡å‹ï¼‰
uv sync --all-extras
```

### åˆå§‹åŒ–

```bash
/semantic init
```

### å»ºç«‹ç´¢å¼•

```bash
# ç´¢å¼•æ•´ä¸ªé¡¹ç›®ï¼ˆä½¿ç”¨æ··åˆå¼•æ“ï¼‰
/semantic-index

# å¢é‡ç´¢å¼•ï¼ˆä»…ç´¢å¼•å˜æ›´æ–‡ä»¶ï¼‰
/semantic-index --incremental

# æˆ–ç´¢å¼•æŒ‡å®šç›®å½•
/semantic-index --path ./src
```

### æœç´¢ä»£ç 

```bash
# è‡ªç„¶è¯­è¨€æœç´¢ï¼ˆæ··åˆæ£€ç´¢ï¼‰
/semantic-search "å¦‚ä½•è¯»å–æ–‡ä»¶"

# æœç´¢å‡½æ•°å®ç°
/semantic-search "å®ç°äºŒåˆ†æŸ¥æ‰¾"

# ä¸­è‹±æ–‡æ··åˆ
/semantic-search "ç”¨æˆ·è®¤è¯ JWT token"
```

## é…ç½®

### æŸ¥çœ‹é…ç½®

```bash
/semantic config
```

### è®¾ç½®æ¨¡å‹

```bash
# FastEmbed æ¨¡å‹
/semantic config --model bge-large-en

# CodeModel æ¨¡å‹ï¼ˆéœ€è¦å…ˆå¯ç”¨å¼•æ“ï¼‰
/semantic engines enable --engine codemodel
/semantic engines model --engine codemodel --model codet5+
```

### ç›¸ä¼¼åº¦é˜ˆå€¼

æ§åˆ¶æœç´¢ç»“æœçš„æœ€å°ç›¸ä¼¼åº¦è¦æ±‚ï¼Œè¿‡æ»¤æ‰ä½ç›¸å…³æ€§çš„ç»“æœã€‚

```bash
# ä½¿ç”¨é»˜è®¤é˜ˆå€¼ï¼ˆ0.7ï¼Œæ¨èï¼‰
/semantic-search "ç”¨æˆ·ç™»å½•"

# è‡ªå®šä¹‰é˜ˆå€¼ï¼ˆä¸´æ—¶è¦†ç›–é…ç½®æ–‡ä»¶ï¼‰
/semantic-search "ç”¨æˆ·ç™»å½•" --threshold 0.8
/semantic-search "ç”¨æˆ·ç™»å½•" -t 0.6
```

**é˜ˆå€¼è¯´æ˜**:
- `0.6`: å®½æ¾ï¼Œé€‚åˆåˆæ¬¡æ¢ç´¢
- `0.7`: **æ¨è**ï¼Œå¹³è¡¡å‡†ç¡®åº¦å’Œå¬å›ç‡
- `0.8`: ä¸¥æ ¼ï¼Œåªè¿”å›é«˜åº¦ç›¸å…³çš„ç»“æœ

é…ç½®æ–‡ä»¶è®¾ç½®ï¼š
```yaml
# ~/.lazygophers/ccplugin/semantic/config.yaml
similarity_threshold: 0.7
```

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒï¼š[é…ç½®æŒ‡å—](docs/configuration-guide.md)

### å¼•æ“ç®¡ç†

```bash
# æŸ¥çœ‹æ‰€æœ‰å¼•æ“
/semantic engines list

# å¯ç”¨ä»£ç æ¨¡å‹å¼•æ“
/semantic engines enable --engine codemodel

# å¯ç”¨ç¬¦å·ç´¢å¼•
/semantic engines enable --engine symbols

# è®¾ç½®æ£€ç´¢ç­–ç•¥
/semantic engines strategy --strategy hybrid
```

**å¯ç”¨å¼•æ“ï¼š**
- `fastembed` - å¿«é€Ÿå‘é‡æœç´¢ï¼ˆé»˜è®¤ï¼‰
- `codemodel` - ä»£ç ä¸“ç”¨æ¨¡å‹æœç´¢ï¼ˆCodeT5/UniXcoderï¼‰
- `symbols` - ç¬¦å·ç´¢å¼•ï¼ˆå‡½æ•°/ç±»åç²¾ç¡®åŒ¹é…ï¼‰

**æ£€ç´¢ç­–ç•¥ï¼š**
- `fast` - ä»…ä½¿ç”¨ FastEmbed
- `hybrid` - æ··åˆæœç´¢ï¼ˆèåˆæ‰€æœ‰å¼•æ“ï¼Œæ¨èï¼‰
- `code` - ä»…ä½¿ç”¨ä»£ç æ¨¡å‹
- `symbols` - ä»…ä½¿ç”¨ç¬¦å·ç´¢å¼•

### è¯­è¨€ç®¡ç†

```bash
# åˆ—å‡ºæ”¯æŒçš„è¯­è¨€
/semantic languages list

# å¯ç”¨è¯­è¨€
/semantic languages enable --lang rust

# ç¦ç”¨è¯­è¨€
/semantic languages disable --lang java
```

## æ¶æ„

### æ··åˆæœç´¢å¼•æ“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hybrid Search Engine                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ£€ç´¢å±‚                                                      â”‚
â”‚  â”œâ”€â”€ FastEmbed Engine (å¿«é€Ÿåˆç­›)                             â”‚
â”‚  â”œâ”€â”€ CodeModel Engine (ä»£ç ä¸“ç”¨æœç´¢)                          â”‚
â”‚  â””â”€â”€ Symbol Index (ç¬¦å·ç²¾ç¡®åŒ¹é…)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èåˆå±‚                                                      â”‚
â”‚  â””â”€â”€ Result Fusion (å¤šç»“æœèåˆæ’åº)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­˜å‚¨å±‚                                                      â”‚
â”‚  â”œâ”€â”€ LanceDB (å‘é‡ç´¢å¼•)                                      â”‚
â”‚  â”œâ”€â”€ SQLite (ç¬¦å·ç´¢å¼•)                                       â”‚
â”‚  â””â”€â”€ æ–‡ä»¶è¿½è¸ª (å¢é‡ç´¢å¼•)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰å±‚å¼•æ“å¯¹æ¯”

| ç‰¹æ€§ | FastEmbed | CodeModel | Symbol |
|------|-----------|-----------|--------|
| é€Ÿåº¦ | âš¡âš¡âš¡ | âš¡âš¡ | âš¡âš¡âš¡ |
| å‡†ç¡®ç‡ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| å†…å­˜ | ä½ | é«˜ | æä½ |
| ç”¨é€” | å¿«é€Ÿåˆç­› | ä»£ç è¯­ä¹‰ | ç²¾ç¡®åŒ¹é… |

### ç»“æœèåˆæƒé‡ï¼ˆæ··åˆæ£€ç´¢ï¼‰

- ç¬¦å·åŒ¹é…æƒé‡ï¼š30%
- FastEmbed å‘é‡ç›¸ä¼¼åº¦ï¼š40%
- CodeModel è¯­ä¹‰ç›¸ä¼¼åº¦ï¼š30%

## æ”¯æŒçš„è¯­è¨€

- Python (.py)
- Go (.go)
- JavaScript (.js, .jsx)
- TypeScript (.ts, .tsx)
- Rust (.rs)
- Flutter/Dart (.dart)
- Android (.java, .kt)
- Bash (.sh)
- C/C++ (.c, .cpp)
- C# (.cs)
- Java (.java)
- Kotlin (.kt)
- Swift (.swift)
- PHP (.php)
- Ruby (.rb)
- Markdown (.md)

## æ”¯æŒçš„æ¨¡å‹

### FastEmbed æ¨¡å‹ï¼ˆå¿«é€Ÿå‘é‡æœç´¢ï¼‰

#### BGE ç³»åˆ—ï¼ˆæ¨èï¼‰
| æ¨¡å‹ | ç»´åº¦ | è¯´æ˜ |
|------|------|------|
| `bge-small-en` | 384 | è‹±æ–‡ä¼˜åŒ–ï¼Œè½»é‡ |
| `bge-small-zh` | 512 | ä¸­æ–‡ä¼˜åŒ– |
| `bge-base-en` | 768 | è‹±æ–‡é€šç”¨ |
| `bge-large-en` | 1024 | è‹±æ–‡é«˜ç²¾åº¦ |

#### Jina ç³»åˆ—
| æ¨¡å‹ | ç»´åº¦ | è¯´æ˜ |
|------|------|------|
| `jina-small-en` | 512 | Jina è‹±æ–‡è½»é‡ |
| `jina-base-en` | 768 | Jina è‹±æ–‡é€šç”¨ |
| `jina-code` | 768 | Jina ä»£ç ä¸“ç”¨ |

#### å…¶ä»–
| æ¨¡å‹ | ç»´åº¦ | è¯´æ˜ |
|------|------|------|
| `all-minilm-l6-v2` | 384 | æè½»é‡ï¼Œå¿«é€Ÿ |
| `multilingual-e5-small` | 384 | å¤šè¯­è¨€ï¼Œè½»é‡ |
| `gte-large` | 1024 | GTE å¤§å‹ |
| `nomic-embed-text-1.5` | 768 | Nomic åµŒå…¥ |

### CodeModel æ¨¡å‹ï¼ˆä»£ç ä¸“ç”¨æœç´¢ï¼‰

| æ¨¡å‹ | è¯´æ˜ |
|------|------|
| `codet5+` | CodeT5+ï¼Œä»£ç ç†è§£æœ€ä½³ |
| `unixcoder` | UniXcoderï¼Œå¤šè¯­è¨€ä»£ç  |
| `graphcodebert` | GraphCodeBERTï¼Œå›¾ç»“æ„ |
| `codebert` | CodeBERTï¼Œä»£ç é¢„è®­ç»ƒ |

å®Œæ•´æ¨¡å‹åˆ—è¡¨è¿è¡Œ: `/semantic models`

## æ•°æ®å­˜å‚¨

æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨é¡¹ç›®ç›®å½•ï¼š

```
.lazygophers/ccplugin/semantic/
â”œâ”€â”€ config.yaml          # é…ç½®æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰
â”œâ”€â”€ lancedb/             # LanceDB å‘é‡æ•°æ®åº“
â”‚   â””â”€â”€ code_index/      # ä»£ç ç´¢å¼•
â””â”€â”€ symbols.db           # SQLite ç¬¦å·ç´¢å¼•
```

## æ€§èƒ½ä¼˜åŒ–

### GPU åŠ é€Ÿ

```bash
# å¯ç”¨ GPUï¼ˆé»˜è®¤ï¼‰
/semantic config --gpu true

# å®‰è£… GPU ç‰ˆæœ¬ï¼ˆLinux/Windowsï¼‰
uv pip install fastembed-gpu
```

### å¢é‡ç´¢å¼•

```bash
# ä»…ç´¢å¼•å˜æ›´æ–‡ä»¶
/semantic-index --incremental
```

### å¼•æ“é€‰æ‹©

- **å¿«é€Ÿæœç´¢**ï¼šä»…å¯ç”¨ `fastembed`
- **é«˜ç²¾åº¦**ï¼šå¯ç”¨æ‰€æœ‰å¼•æ“ï¼Œä½¿ç”¨ `hybrid` ç­–ç•¥
- **ç²¾ç¡®åŒ¹é…**ï¼šå¯ç”¨ `symbols`
- **ä»£ç è¯­ä¹‰**ï¼šå¯ç”¨ `codemodel`

### æ¨¡å‹é€‰æ‹©

- **è½»é‡å¿«é€Ÿ**ï¼š`all-minilm-l6-v2` (384ç»´)
- **ä¸­æ–‡é¡¹ç›®**ï¼š`bge-small-zh` (512ç»´)
- **é«˜ç²¾åº¦**ï¼š`bge-large-en` (1024ç»´)
- **ä»£ç ä¸“ç”¨**ï¼š`codet5+` (CodeModel)

## è¯­è¨€ç‰¹å®šä¼˜åŒ–

Semantic ä¸ºä¸åŒç¼–ç¨‹è¯­è¨€æä¾›é’ˆå¯¹æ€§çš„ä¼˜åŒ–ç­–ç•¥ï¼ŒåŒ…æ‹¬è§£æå™¨ã€åˆ†å—å¤§å°ã€æ¨¡å‹æ¨èç­‰ã€‚

### é«˜ä¼˜å…ˆçº§è¯­è¨€ï¼ˆå®Œæ•´è§£æï¼‰

| è¯­è¨€ | åˆ†å—å¤§å° | è§£æå™¨ | æ¨èæ¨¡å‹ | ç‰¹æ€§ |
|------|----------|--------|----------|------|
| **Python** | 500 | AST | codet5+ | å‡½æ•°/ç±»/è£…é¥°å™¨/ç±»å‹æç¤º |
| **Golang** | 400 | æ­£åˆ™ | jina-code | å‡½æ•°/æ¥å£/ç»“æ„ä½“ |
| **Rust** | 300 | æ­£åˆ™ | unixcoder | å‡½æ•°/ç»“æ„ä½“/ç‰¹è´¨/impl |
| **Flutter** | 450 | æ­£åˆ™ | codet5+ | Widget/ç±»/æ–¹æ³• |
| **Java** | 450 | javalang AST | codet5+ | ç±»/æ¥å£/æ³¨è§£ |
| **Kotlin** | 420 | æ­£åˆ™ | codet5+ | ç±»/å‡½æ•°/å¯¹è±¡/æ‰©å±• |
| **TypeScript** | 400 | æ­£åˆ™ | jina-code | ç±»/æ¥å£/ç±»å‹ |

### ä¸­ä¼˜å…ˆçº§è¯­è¨€ï¼ˆåŸºç¡€è§£æï¼‰

| è¯­è¨€ | åˆ†å—å¤§å° | è§£æå™¨ | æ¨èæ¨¡å‹ |
|------|----------|--------|----------|
| JavaScript | 400 | æ­£åˆ™ | jina-code |
| C++ | 380 | ç®€å•åˆ†å— | unixcoder |
| C# | 420 | ç®€å•åˆ†å— | codet5+ |
| Swift | 400 | ç®€å•åˆ†å— | codet5+ |

### ä½ä¼˜å…ˆçº§è¯­è¨€ï¼ˆç®€å•åˆ†å—ï¼‰

| è¯­è¨€ | åˆ†å—å¤§å° | æ¨èæ¨¡å‹ |
|------|----------|----------|
| C | 350 | unixcoder |
| PHP | 380 | codet5+ |
| Ruby | 350 | codet5+ |
| Bash | 200 | multilingual-e5-small |
| Markdown | 1000 | multilingual-e5-large |

### å¯é€‰ä¾èµ–

```bash
# å®‰è£…å®Œæ•´ä¾èµ–ï¼ˆåŒ…å« Java AST è§£æï¼‰
uv sync --all-extras

# ä»…å®‰è£…è¯­è¨€è§£æå™¨
uv sync --extra parsers
```

**æ³¨æ„**ï¼š
- Java è§£æä½¿ç”¨ `javalang` åº“æä¾› AST çº§ç²¾åº¦
- Rust è§£æä½¿ç”¨é«˜è´¨é‡æ­£åˆ™ï¼ˆsyn æ˜¯ Rust åŸç”Ÿåº“ï¼‰
- å…¶ä»–è¯­è¨€ä½¿ç”¨å†…ç½®è§£æå™¨

## ç¤ºä¾‹

### æœç´¢ API ç”¨æ³•

```bash
/semantic-search "å¦‚ä½•ä½¿ç”¨ requests åº“å‘é€ HTTP è¯·æ±‚"
```

### æœç´¢ç®—æ³•å®ç°

```bash
/semantic-search "å®ç°å¿«é€Ÿæ’åºç®—æ³•"
```

### æœç´¢è®¾è®¡æ¨¡å¼

```bash
/semantic-search "å•ä¾‹æ¨¡å¼å®ç°"
```

### é™å®šè¯­è¨€

```bash
/semantic-search "sort" --language python
```

### æŸ¥çœ‹ç»Ÿè®¡

```bash
/semantic stats
```

## æœ€ä½³å®è·µ

1. **å®šæœŸæ›´æ–°ç´¢å¼•** - ä»£ç å˜æ›´åè¿è¡Œå¢é‡ç´¢å¼•
2. **ä½¿ç”¨è‡ªç„¶è¯­è¨€** - æè¿°åŠŸèƒ½è€Œéè¯­æ³•
3. **ä¸­è‹±æ–‡æ··åˆ** - æ··åˆæŸ¥è¯¢æ•ˆæœæœ€ä½³
4. **é€‰æ‹©åˆé€‚ç­–ç•¥** - å°é¡¹ç›®ç”¨ `fast`ï¼Œå¤§é¡¹ç›®ç”¨ `hybrid`
5. **éªŒè¯ç»“æœ** - æ£€æŸ¥ä»£ç æ˜¯å¦åŒ¹é…éœ€æ±‚

## æŠ€æœ¯æ ˆ

- **LanceDB** - å‘é‡æ•°æ®åº“
- **FastEmbed** - è½»é‡çº§åµŒå…¥åº“ï¼ˆONNX Runtimeï¼‰
- **sentence-transformers** - ä»£ç æ¨¡å‹ï¼ˆå¯é€‰ï¼‰
- **SQLite** - ç¬¦å·ç´¢å¼•
- **Typer** - CLI æ¡†æ¶
- **Rich** - ç»ˆç«¯ç¾åŒ–

## å¼€å‘

```bash
# è¿›å…¥æ’ä»¶ç›®å½•
cd plugins/semantic

# å®‰è£…å¼€å‘ä¾èµ–
uv sync

# å®‰è£…å®Œæ•´ä¾èµ–ï¼ˆåŒ…å«ä»£ç æ¨¡å‹ï¼‰
uv sync --all-extras

# è¿è¡Œæµ‹è¯•
uv run pytest

# ä»£ç æ ¼å¼åŒ–
uv run black scripts/
uv run ruff check scripts/
```

## License

AGPL-3.0-or-later

## ä½œè€…

lazygophers <admin@lazygophers.dev>

## é“¾æ¥

- [GitHub](https://github.com/lazygophers/ccplugin)
- [æ–‡æ¡£](https://github.com/lazygophers/ccplugin/tree/master/plugins/semantic)
- [FastEmbed](https://github.com/qdrant/fastembed)
- [HYBRID.md](./HYBRID.md) - æ··åˆæ¶æ„è¯¦ç»†æ–‡æ¡£

