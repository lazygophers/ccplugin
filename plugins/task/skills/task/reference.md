# 任务管理完整规范

## 目录结构

```
@.claude/task/
├── todo.md              # 待完成任务
├── in-progress.md       # 进行中任务
├── done.md              # 已完成任务（本会话或最近）
└── archive/             # 按项目/模块组织的历史任务
    ├── ccplugin/
    │   ├── features.md
    │   ├── plugins.md
    │   └── infrastructure.md
    ├── project-name/
    │   ├── backend.md
    │   ├── frontend.md
    │   └── devops.md
    └── README.md        # 存档说明
```

## 文件规范

### todo.md - 待完成任务

**用途**：存放所有未开始的任务

**内容结构**：

```markdown
# 待完成任务 (TODO)

## 使用规范

参考 [@plugins/task](../../plugins/task/skills/SKILL.md) 中的完整指南。

## 功能模块 1

### [P{N}] TASK-{编号} {任务标题}

- **类别**: {功能/文档/重构/bug/测试}
- **描述**: {详细说明，包括为什么需要做、目标、范围}
- **验收标准**:
  - [ ] 标准 1 - 具体可验证的要求
  - [ ] 标准 2 - 具体可验证的要求
- **子任务** (可选):
  - [ ] 子任务 1
  - [ ] 子任务 2

## 功能模块 2

### [P{N}] TASK-{编号} {任务标题}

- **类别**: {功能/文档/重构/bug/测试}
- **描述**: {详细说明，包括为什么需要做、目标、范围}
- **验收标准**:
  - [ ] 标准 1
  - [ ] 标准 2
```

**字段说明**：

| 字段 | 必需 | 说明 |
|------|------|------|
| 任务编号 | ✓ | 唯一标识号，格式 TASK-NNN，便于追踪和引用 |
| 任务标题 | ✓ | 清晰明确的任务描述，包含优先级标记 [P0/P1/P2/P3] |
| 类别 | ✓ | 功能(feature)/文档(docs)/重构(refactor)/bug/测试(test)/配置(config) |
| 描述 | ✓ | 详细说明任务的背景、目标、范围和关键要求 |
| 相关文件 | ✗ | 涉及修改的主要文件或系统，用于快速定位 |
| 验收标准 | ✓ | 列出具体可验证的完成标准（使用复选框跟踪） |
| 子任务 | ✗ | 拆分为更小的可执行步骤（可选，适用于复杂任务） |
| 预期工作量 | ✗ | 估计的工作量（如：半天/1天/2-3天） |

### in-progress.md - 进行中任务

**用途**：存放当前正在执行的任务

**内容结构**：

```markdown
# 进行中任务 (IN-PROGRESS)

## 会话进行中的任务

### [P{N}] TASK-{编号} {任务标题}

- **类别**: {功能/文档/重构/bug}
- **描述**: {详细说明}
- **进展**: {当前进展：如 30% 已完成 API 框架搭建，正在实现核心逻辑}
- **完成的验收标准**:
  - [x] 标准 1
  - [ ] 标准 2
- **下一步**: {接下来需要做的步骤}
```

**字段说明**：

| 字段 | 必需 | 说明 |
|------|------|------|
| 任务编号 | ✓ | 来自 TODO 的 TASK-NNN 编号 |
| 类别 | ✓ | 任务的分类 |
| 描述 | ✓ | 任务的详细说明 |
| 进展 | ✓ | 当前的进展情况，可以用百分比或具体描述 |
| 完成的验收标准 | ✗ | 逐步更新验收标准的完成状态（使用复选框跟踪） |
| 下一步 | ✗ | 接下来需要执行的步骤，便于中断后恢复 |

**重要**：一个会话内通常应该只有 1-3 个进行中的任务，过多表示需要优先级调整或任务拆分。

### done.md - 已完成任务

**用途**：存放本会话或最近完成的任务，作为归档前的临时区

**内容结构**：

```markdown
# 已完成任务 (DONE)

## 本会话完成的任务

### [P{N}] TASK-{编号} {任务标题} ✓

- **类别**: {功能/文档/重构/bug}
- **说明**: {任务的最终说明，包括解决方案、实现方式等}
- **验收标准完成情况**:
  - [x] 标准 1 - 说明完成方式
  - [x] 标准 2 - 说明完成方式
- **关键交付物**:
  - 创建了 @.claude/task 目录结构
  - 编写了 multi-file skills 文档
  - 配置了三个 hooks
- **关联提交**: 7494344 (如有git提交)
```

**字段说明**：

| 字段 | 必需 | 说明 |
|------|------|------|
| 任务编号 | ✓ | 来自 TODO 的 TASK-NNN 编号 |
| 类别 | ✓ | 任务的分类 |
| 说明 | ✓ | 任务的最终说明，包括实现方式或解决方案 |
| 验收标准完成情况 | ✗ | 确认所有验收标准都已完成并说明完成方式 |
| 关键交付物 | ✓ | 列出任务的主要成果（文件、功能、文档等） |
| 关联提交 | ✗ | 如果有对应的git提交，记录提交hash或PR链接 |

### archive/ - 历史任务存档

**用途**：存放历史完成的任务，按项目/模块组织

**目录结构**：

按项目或模块创建子目录，每个子目录包含该项目/模块的所有完成任务：

```
archive/
├── ccplugin/                  # 主项目
│   ├── README.md             # 本目录说明
│   ├── features.md           # 功能开发任务
│   ├── plugins.md            # 插件相关任务
│   ├── infrastructure.md      # 基础设施和工具
│   └── documentation.md       # 文档和规范
├── project-name/             # 其他项目
│   ├── backend.md
│   ├── frontend.md
│   └── devops.md
└── research/                 # 研究和探索任务
    └── experiments.md
```

**文件内容格式**：

```markdown
# CCPlugin - 功能开发

## 任务列表

### [P1] TASK-015 重新设计任务管理系统 ✓

- **类别**: 功能重构
- **说明**: 将 task 插件从 Python 脚本方式改为基于 hooks 和文件系统的设计，提高任务管理的可用性和灵活性。
- **关键交付物**:
  - @.claude/task/ 目录和初始文件 (todo.md, in-progress.md, done.md, archive/)
  - @plugins/task 的 multi-file skills 文档 (SKILL.md, reference.md, examples/)
  - 三个 hooks 配置 (SessionStart, UserPromptSubmit, Stop)
  - 删除了旧的 Python 脚本
- **关联提交**: 7494344, abc123def

### [P2] TASK-016 优化版本更新脚本 ✓

- **类别**: 工具优化
- **说明**: 适配新的插件目录结构，使脚本能够递归扫描所有 plugin.json 文件。
- **关键交付物**:
  - 更新了 scripts/update_version.py
  - 现在能处理所有 27 个插件（13+12+2）
- **关联提交**: 7494344
```

## 任务优先级

| 优先级 | 标记 | 说明 | 处理时间 |
|--------|------|------|----------|
| 紧急 | P0 | 需要立即处理，影响项目进度或线上服务 | 当天 |
| 高 | P1 | 重要任务，需要尽快处理 | 本周 |
| 普通 | P2 | 常规任务，按计划处理 | 本月 |
| 低 | P3 | 优化或改进，有时间再处理 | 不确定 |

## 任务分类

| 分类 | 标记 | 说明 | 示例 |
|------|------|------|------|
| 功能 | feature | 新功能开发、功能增强 | 实现用户认证、添加导出功能 |
| Bug | bug | 缺陷修复、问题解决 | 修复API超时、修复内存泄漏 |
| 重构 | refactor | 代码重构、性能优化 | 优化查询性能、重构错误处理 |
| 文档 | docs | 文档编写、更新 | 编写API文档、更新README |
| 测试 | test | 测试相关工作 | 编写单元测试、集成测试 |
| 配置 | config | 配置和环境设置 | Docker配置、CI/CD流程 |

## 任务编写最佳实践

### 清晰的标题

✅ **好的标题**：
- `[P1] 实现用户登录功能`
- `[P2] 修复 API 响应超时问题`
- `[P3] 优化数据库查询性能`

❌ **不好的标题**：
- `[P1] 完成用户模块`（太宽泛）
- `[P0] 快点完成`（不专业）
- `[P2] 修复bug`（缺少上下文）

### 详细的描述

描述应该包含：
1. **背景** - 为什么需要做这件事
2. **目标** - 想要达到什么效果
3. **范围** - 涉及哪些部分或模块
4. **关键需求** - 必须满足的条件

示例：
```markdown
### [P1] 实现用户认证系统

- **类别**: feature
- **描述**: 在后端实现基于JWT的用户认证系统，支持注册、登录、刷新令牌等功能。

  背景：当前系统没有用户管理功能，无法区分不同用户的数据。

  目标：实现完整的用户认证流程，支持 OAuth 2.0 标准。

  范围：
  - 数据库用户表设计
  - JWT 令牌生成和验证
  - 登录/注册 API 实现
  - 令牌刷新机制

  关键需求：
  - 密码需加密存储（bcrypt）
  - 令牌过期时间 1 小时
  - 刷新令牌有效期 7 天
  - 支持多设备登录
```

## 定期维护

### 每日检查清单

- [ ] 检查 `in-progress.md` 中的任务进展
- [ ] 更新进行中任务的进展信息
- [ ] 如任务已完成，移动到 `done.md`
- [ ] 检查是否有新的任务需要添加到 `todo.md`

### 每周整理

- [ ] 回顾本周完成的任务
- [ ] 总结阻碍和挑战
- [ ] 更新下周的任务优先级
- [ ] 考虑是否需要对任务进行调整

### 定期归档

- [ ] 当 `done.md` 超过 200 行时，考虑归档
- [ ] 将已完成的任务按项目/模块整理到 `archive/`
- [ ] 保持文件大小可控（<500KB）
- [ ] 定期备份 `archive/` 目录

## 与 Git 的集成

### 提交关联

完成任务时，在 `done.md` 中记录关联的 git 提交：

```markdown
- **关联提交**: 7494344 (fix: update version script for new plugin structure)
```

可以记录单个提交hash或多个关联提交：

```markdown
- **关联提交**: 7494344, abc123def, xyz789
```

### 任务和 PR 的关系

如果任务对应一个 Pull Request：

```markdown
- **关联提交**: PR#123 (https://github.com/project/pull/123)
```

---

**参考文献**：
- [SKILL.md](SKILL.md) - 快速开始
- [examples.md](examples.md) - 使用示例
