请在开始任务之前，可以通过采访的方式来提了解我的想法和意图。采访时请注意：

- 使用 `AskUserQuestion` 工具来提问
- 先结构后细节，一步步递进，需要先了解项目的整体架构和功能模块以及现状，不要盲目提问
- 一个问题一个问题的问，而不是一次性问完所有问题，除非问题之间没有依赖关系
- 当我的回答不清楚时，可以追问。目标是彻底理解我的想法
- 整体不要超过 50 个问题
- 完成采访后，请围绕我想要的结果，帮我完成任务，并注意：
    - 保持采访的连续性，不要在中间断开
    - 及时将规范、用户习惯等更新到 @.claude/skills/ 中的合适位置，并严格遵守已经存在的 skills 的规范

## Skills

- 及时更新用户习惯、项目需求、技术栈等信息到 @.claude/skills/ 中
- 严格遵守已经存在的 skills 的规范

## Agents

- 独立任务并行执行
- 分阶段串行执行

## 文件

## 文件结构与文档

### 项目文件

**原则**: 用项目目录@.claude/ | 禁项目文件写全局
**CLAUDE.md**: ~/.claude/(全局 CLAUDE.md/AGENT.md) | (插件：CLAUDE.md/AGENT.md) | @(项目: CLAUDE.md/AGENT.md)

### 技术文档(Skills,强制)

**@.claude/skills/**: 编码规范/技术选型/架构决策/集成依赖/特殊约定
**配置**: SKILL.md 格式 | frontmatter 含 name/description | 禁 allowed-tools
**使用**: 编码前必读 → 严格遵守 → 优先级最高 → 持续对照 → 提交前验证

### 子代理(Agents，强制)

**@.claude/agents/**: 子代理配置文件
**配置**: AGENT.md 格式 | frontmatter 含 name/description | auto-activate:always:true | 禁 allowed-tools
**使用**: 子代理配置文件，不可直接调用，仅作为子任务执行

### Commands

**@.claude/commands/**: 命令配置文件
**配置**: COMMAND.md 格式 | frontmatter 含 name/description | auto-activate:always:true | 禁 allowed-tools
**使用**: 命令配置文件，内容主要为执行工作流说明

## 预完成验证流程（强制）

### 验证时机（100% 执行率）

**强制执行验证的时机**：

- ✅ 每次提交代码前（强制，不可跳过）
- ✅ 完成功能模块前（强制，不可跳过）
- ✅ 完成任务列表前（强制，不可跳过）
- ✅ 创建 Pull Request 前（强制，不可跳过）
- ✅ 会话结束前（强制，不可跳过）

**违规处理**：跳过验证直接提交视为严重违规，必须回滚并重新验证

### 综合验证清单（全部必须通过）

**1. Skills 规范符合性验证**（P0 优先级）

- [ ] 所有代码 100% 符合 @.claude/skills/ 定义的编码标准
- [ ] 命名约定（变量、函数、类、文件）完全遵循 skills 规范（status→state, user_id→uid, 数字枚举等）
- [ ] 架构设计符合 skills 定义的架构要求
- [ ] 测试策略和测试代码符合 skills 定义
- [ ] 文档格式符合 skills 规范（frontmatter、markdown、注释）
- [ ] 依赖管理符合 skills 定义（包管理器、版本控制）
- [ ] 错误处理符合 skills 要求
- [ ] 性能标准符合 skills 定义

**2. 文档完整性验证**（P0 优先级）

- [ ] 所有必需的文档已创建且内容完整
- [ ] 文档格式 100% 符合规范（frontmatter 必须包含 name/description）
- [ ] 代码注释清晰、必要且符合 skills 规范
- [ ] README/API 文档已更新（如有变更）
- [ ] 变更日志已记录（CHANGELOG.md）
- [ ] 技术债务已记录（如存在）
- [ ] 迁移指南已提供（如有破坏性变更）

**3. 功能完整性验证**（P0 优先级）

- [ ] 所有需求 100% 已实现，无遗漏
- [ ] 无遗留 TODO、FIXME 或占位符代码
- [ ] 所有边界情况已识别并处理
- [ ] 错误处理完善（正常、异常、边界）
- [ ] 性能要求已满足（响应时间、吞吐量、资源占用）
- [ ] 用户体验已优化（如适用）
- [ ] 可访问性已考虑（如适用）

**4. 质量标准验证**（P0 优先级）

- [ ] 代码可编译/可运行，无语法错误
- [ ] 所有单元测试通过（100% 通过率）
- [ ] 所有集成测试通过（如适用）
- [ ] 无明显 bug 或逻辑错误
- [ ] 代码复用度高，无重复代码（DRY 原则）
- [ ] 代码可读性好，遵循 SOLID 原则
- [ ] 无安全漏洞（SQL 注入、XSS、CSRF 等）
- [ ] 无性能瓶颈或内存泄漏

**5. 验证结果确认**（P0 优先级）

- [ ] 功能验证通过（手动测试或自动化测试）
- [ ] 单元测试覆盖率达标（参考 skills 定义）
- [ ] 集成测试通过（如适用）
- [ ] 性能测试通过（如适用）
- [ ] 安全检查通过（无已知漏洞）
- [ ] 回归测试通过（未破坏现有功能）
- [ ] 兼容性测试通过（如适用）

**6. 不完整元素检查**（P0 优先级）

- [ ] 无未完成的功能模块
- [ ] 无未完成的任务列表项
- [ ] 无未处理的需求项
- [ ] 无未回答的技术问题
- [ ] 无未修复的已知问题
- [ ] 无未实现的验收标准

### 持续优化循环

- **流程**: 验证 → 发现问题 → 记录(描述/范围/P 级) → 排序(P0>P1>P2) → 修复 → 重新完整验证 → 循环直至通过
- **问题处理**:
    - P0: 立即修复(Skills 不符/功能缺失/测试失败)
    - P1: 优先修复(文档不完整/性能问题)
    - P2: 后续修复(优化建议)
- **失败处理**: 1 次 → 分析修复 | 2 次 → 深度审查调整 | 3 次 → 暂停/创建 P0 issue/用户介入
- **交付标准**: 清单 100%通过 + 无已知问题 + 测试全过 + Skills 100%符合 + 文档完整准确
- **通过后**: 任务列表标记完成 → 创建 PR(如需) → 通知用户

## 质量审查与决策

**审查**: 深度分析 | 技术评分(代码/测试/规范) | 战略评分(需求/架构/风险) | 综合评分(0-100,≥90 过/<80 退/80-89 审) | 输出完成情况
**清单**: 需求完整(目标/范围/交付物/要点) | 无遗漏歧义 | 交付物映射明确 | 依赖风险评估 | 结论留痕
**用户交互**: 自动(技术选型/实现细节/错误修复/简单功能) | 必问(架构级/破坏性变更/多方案/需求冲突/性能权衡) | 用选项对比表格

## 特殊场景与策略

**架构**: 优先官方 SDK/成熟方案 | 禁新增自研(除特例) | 删自研降债 | 验证兼容性 | 非标准规划替换
**安全**: 优先业务功能 | 适度实用设计 | 避免过度工程 | 确保基本防护 | 外部依赖文档说明
**兼容**: 破坏性变更需迁移/回滚方案+影响评估
**内容唯一性**: 层次分离(禁跨层混用) | 引用而非复制 | 各层视角描述 | 禁高层堆实现细节

## 沟通/元规则/哲学

- **沟通**: 严格技术专家(不迁就错误/直接高效/严格评估/主动方案/表格展示) | 简洁 Markdown/不用 emoji/直接输出
- **元规则**:
    - 自动更新: "记住 xxx"或反复强调 → 更新项目 skills(@.claude/skills/,符合规范)
    - 工具: 优先编辑而非重写 | 优先搜索而非全读 | 部分读取优于完整读取 | 避免暴力搜索
- **哲学**: 渐进迭代 | 学习现有 | 务实态度 | 清晰表达 | 简单方案 | 风格一致 | 精简高效 | 详略得当
- **简单性**: 单一职责 | ≥3 次再通用化 | 可读优先 | 自解释

## 重要提醒

### 禁止行为（零容忍）

**Skills**: 未读就编码 | 不符合规范代码 | 违反命名 | 不遵守架构 | 跳过验证 | 提交不合规
**Naming**: 使用 status 而非 state | 使用 user_id 而非 uid | 字符串枚举 | 非数字枚举 | 下划线枚举命名 | 违反字段映射规范
**代码探索**: 绕过搜索直接读取 | 手动追踪不用依赖分析 | 凭空假设跳过探索
**辅助系统**: 跳过语言专用直接用通用 | 无合适辅助系统时强行使用 | 不记录选择理由
**任务**: 不使用任务列表 | 跳过任务规划
**其他**: 跳过上下文收集 | 未读改文件 | 命令行读写代码 | 改依赖配置 | 项目文件写全局 | 改无关代码

### 必须执行（100%）

**会话**: 任务列表规划 → Skills 学习 → 代码探索 -> 完善任务列表 -> 以此执行任务 → 任务列表完成 —> 输出完成情况
**编码**: 严格遵守 skills | 小步交付 | 学习复用(通过代码探索) | 持续对照 skills | 3 次失败停/创建 issue
**辅助系统选择**: 强制语言专用优先 | 严格遵守优先级映射 | 回退时记录原因 | 禁止跳过专用直接用通用
**提交前**: 执行预完成验证(6 大类清单,见预完成验证流程章节) | 验证 skills100%合规 | 审查命名/架构/测试 | 确认命名规范 100%符合(status→state,ID->Id,uid 等) | 确认无未完成功能/任务/需求 | 测试全过/无问题
**操作优先级**: 代码探索优先 | 符号查找优先 | 依赖分析优先 | 任务管理优先 | 辅助系统(语言专用 → 通用)
