# 代理定义

## 什么是代理

代理（Agent）是**自主执行复杂任务的子进程**，拥有独立的上下文和工具集。

### 与 Command/Skill 的区别

| 组件 | 用途 | 触发方式 | 特点 |
|------|------|----------|------|
| **Agent** | 执行任务 | `@agent` | 自主决策，多步骤，独立上下文 |
| **Command** | 执行操作 | `/command` | 即时执行，单步 |
| **Skill** | 行为指导 | 自动匹配 | 影响后续行为 |

## 代理使用场景

### 场景 1：复杂探索

```
@explore 分析代码库结构
@explore 查找安全漏洞
```

### 场景 2：代码审查

```
@review 审查最近提交
@review 检查性能问题
```

### 场景 3：开发任务

```
@dev 实现新功能
@dev 修复 bug
```

### 场景 4：研究任务

```
@research 调研新技术
@research 对比方案
```

## 代理文件格式

### 最小格式

```yaml
---
name: dev
description: 开发专家
---

# 开发专家

帮助用户进行软件开发...
```

### 完整格式

```yaml
---
name: dev
description: Python 开发专家
context: fork
tools:
  - Read
  - Write
  - Edit
  - Bash
  - Glob
model: inherit
color: "#4CAF50"
---

# Python 开发专家

你是 Python 开发专家，帮助用户编写高质量代码。

## 能力

- 代码编写和重构
- 单元测试编写
- 性能优化
- 错误排查

## 工作流程

1. 理解需求
2. 分析代码
3. 实现方案
4. 测试验证
```

## 代理执行流程

```
1. 用户输入 @agent 任务描述
   ↓
2. 读取 agents/agent.md
   ↓
3. 解析 frontmatter（工具权限等）
   ↓
4. 加载系统提示词
   ↓
5. 创建子进程（fork 或 inherit）
   ↓
6. 代理自主执行
   ↓
7. 返回结果
```

## 何时使用代理

### 使用主对话

- 任务需要频繁的来回或迭代细化
- 多个阶段共享重要上下文
- 正在进行快速、有针对性的更改
- 延迟很重要

### 使用 subagents

- 任务产生大量详细输出
- 想强制执行特定的工具限制
- 工作是自包含的，可以返回摘要
